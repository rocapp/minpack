name: wheel

on: [push, workflow_dispatch]

jobs:
  
  sdist:
    
    runs-on: ubuntu-latest
    
    steps:
    
      - name: Build wheel
        if: github.ref == 'refs/heads/main'
        run: |
          # build the ubuntu-friendly wheel
          make build_ubuntu_python
          
      - name: Create GitHub Release and Upload Wheel
        if: github.ref == 'refs/heads/main'  # Only run for the main branch
        run: |
          # Install GitHub CLI
          sudo apt install -y gh
  
          # Authenticate with GitHub CLI
          echo "${{ secrets.GITHUB_TOKEN }}" | gh auth login --with-token
  
          # Create a new GitHub release
          gh release create v${{ github.run_number }} ./dist/*.whl \
            --title "Release v${{ github.run_number }}" \
            --notes "Auto-generated release"
